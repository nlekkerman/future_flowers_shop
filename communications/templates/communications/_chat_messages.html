{% extends 'base.html' %}

{% block content %}
<h2>Chat with {{ conversation.superuser.username }}</h2>

<div id="chat-messages">
    {% for chat_message in chat_messages %}
    <div class="message {% if chat_message.sender == request.user %}sent{% else %}received{% endif %}">
        <p>
            <strong>
                {% if request.user.is_superuser %}
                    {% if chat_message.sender == chat_message.conversation.user %}
                        {{ chat_message.sender.username }}: <!-- Display the username of the user in conversation -->
                    {% else %}
                        {{ chat_message.sender.username }}: <!-- Display the username of the superuser -->
                    {% endif %}
                {% else %}
                    {% if chat_message.sender == request.user %}
                        {{ request.user.username }}: <!-- Display the logged-in user's username -->
                    {% else %}
                        {{ chat_message.sender.username }}: <!-- Display the other user's username -->
                    {% endif %}
                {% endif %}
            </strong>
            {{ chat_message.content }}
        </p>
        <p class="timestamp">{{ chat_message.sent_at|date:"F j, Y, g:i a" }}</p> <!-- Format timestamp -->
    </div>
    {% endfor %}
</div>

<h3>Send a new message</h3>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn">Send</button>
</form>
{% endblock %}
